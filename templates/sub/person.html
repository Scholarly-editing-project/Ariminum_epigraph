<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Roman Epigraphy</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.css">
	<link rel="stylesheet" href="../css/style.css">
	<link href="https://fonts.googleapis.com/css?family=EB+Garamond" rel="stylesheet">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

</head>

<body>

	<header class="header clearfix">
		<a href="/" class="header__logo">ROMAN</br>
			EPIGRAPHY</a>
		<a href="" class="header__icon-bar">
			<span></span>
			<span></span>
			<span></span>
		</a>
		<ul class="header__menu animate">
			<li class="header__menu__item">
				<a href="/">Home</a>
			</li>
			<li class="header__menu__item">
				<a href="/project">Project</a>
			</li>
			<li class="header__menu__item">
				<a href="/inscriptions">Inscriptions</a>
			</li>
			<li class="header__menu__item">
				<a href="/contact">Contact</a>
			</li>
		</ul>
	</header>

	<section class="cover cover--single">
		<div class="cover__filter"></div>
		<div class="cover__caption">
			<div class="cover__caption__copy">
				<h1 id="person__name" style="font-weight:100;">Person's name</h1>
			</div>
		</div>
	</section>


	<article class="panel">
		<div class="panel__copy">
			<p class="description__event" align="center">
				Praenomen:
				<strong id="person__praenomen"></strong>
			</p>
			<p class="description__event" align="center">
				Nomen:
				<strong id="person__nomen"></strong>
			</p>
			<p class="description__event" align="center">
				Cognomen:
				<strong id="person__cognomen"></strong>
			</p>
			<p class="description__event" align="center">
				Gender:
				<strong id="person__gender"></strong>
			</p>
			<p class="description__event" align="center">
				Age:
				<strong id="person__age"></strong>
			</p>
			<p class="description__event" align="center">
				Social status:
				<strong id="person__status"></strong>
			</p>
			<p class="description__event" align="center">
				City:
				<strong id="person__city"></strong>
			</p>
		</div>
	</article>

	<section class="cover2 cover--single">
		<div class="cover__filter"></div>
		<div class="cover__caption">
		</div>
	</section>

	<article class="panel">
		<div class="panel__copy" style="margin-top:0px;">
			<h2>Relationships</h2>
			<ul type="square" id="person__relations">
			</ul>
		</div>
	</article>

	<hr style="position:relative; top:-40px;">

	<article class="panel">
		<div class="panel__copy" style="margin-top:0px;">
			<h2>Career</h2>
			<ul type="square" id="person__career">
			</ul>
		</div>
	</article>

	<hr style="position:relative; top:-40px;">

	<article class="panel">
		<div class="panel__copy" style="margin-top:0px;">
			<h2>Actions</h2>
			<ul type="square" id="person__actions">
			</ul>
		</div>
	</article>

	<hr style="position:relative; top:-40px;">

	<article class="panel">
		<div class="panel__copy" style="margin-top:0px;">
			<h2>Documents</h2>
			<ul id="person__documents" type="square">
			</ul>
		</div>
	</article>

	<footer class="footer">
		<section class="cards clearfix">
			<div class="card">
				<div class="card__copy">
					<h4>
						<strong>Roman Epigraphy</strong>
					</h4>
					<p>
						<a href="project.html" class="footerlink" alt="Site map">Site map</a> | Policy |
						<a>Contact</a>
						<br/> Latest modification January 2018
						<br/> Blog | Newsletter
						<br/>
					</p>
					<p>Copyright
						<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/it/deed.it" class="footerlink" alt="Link a licenza Creative Commons"
						  target="_blank">Creative Commons</a>
					</p>
				</div>
			</div>
			<div class="card">
				<div class="card__copy">
					<h4>
						<strong>Links</strong>
					</h4>
					<p>
						<a href="#" class="footerlink">Facebook</a>
						<br/>
						<a href="#" class="footerlink">Twitter</a>
						<br/>
						<a href="#" class="footerlink">Instagram</a>
						</br>
						<a href="#" class="footerlink">Github</a>
						<br/>
						<a href="#" class="footerlink">
							<a href="http://validator.w3.org/check?uri=referer" class="footerlink" title="Validatore w3 codice HTML" target='_blank'>HTML 5</a> |
							<a href="http://jigsaw.w3.org/css-validator/check/referer" class="footerlink" title="Validitore w3 codice CSS" target="_blank">CSS</a>
						</a>
					</p>
				</div>
			</div>
			<div class="card">
				<div class="card__copy">
					<h4>
						<strong>About</strong>
					</h4>
					<p>This website has been created by
						<br/>
						<a>Martina Dello Buono</a>,
						<a>Fabio Mariani</a> and
						<a>Gianmarco Spinaci</a> for the Scholarly Editing and Digital Approaches exam.</p>
					<p>
						<a href='http://www.unibo.it/it' alt="Website of University of Bologna" class="footerlink" target='_blank'>University of Bologna</a>
					</p>
					</p>
				</div>
			</div>
		</section>
	</footer>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
	<script>
		$(document).ready(function () {

			$(".header__icon-bar").click(function (e) {

				$(".header__menu").toggleClass('is-open');
				e.preventDefault();

			});

			const url = '../api/people/' + Cookies.get('people_id')

			$.ajax({
				method: "GET",
				dataType: 'json',
				url: url
			}).done(function (person) {

				if (person.length > 0) {

					person = person[0]

					// Id
					$('#person__name').text(
						`	${person.name.praenomen?person.name.praenomen:''} 
							${person.name.nomen?person.name.nomen:''} 
							${person.name.cognomen?person.name.cognomen:''}`
					)

					// Name
					$('#person__praenomen').text(person.name.praenomen)
					$('#person__nomen').text(person.name.nomen)
					$('#person__cognomen').text(person.name.cognomen)

					// General metadata
					$('#person__gender').text(person.gender)
					$('#person__age').text(person.age)
					$('#person__status').text(person.social_status)
					$('#person__city').html(person.city)

					// Relations
					$('#person__relations').html('')
					person.relation.forEach(function (relation) {

						var peopleUrl = '../api/people/' + relation.person

						$.ajax({
							method: "GET",
							dataType: 'json',
							url: peopleUrl,
							success: function (person) {
								var person = person[0]
								$('#person__relations').append(
									`<li><p>${relation.is} <a href="../people/${person['_id']}">
									${person.name.praenomen?person.name.praenomen:''} 
									${person.name.nomen?person.name.nomen:''} 
									${person.name.cognomen?person.name.cognomen:''}</a></p>`
								)
							},
							error: function (err) {
								$('#person__relations').append(
									`<li><p>${relation.is} ${relation.person}</p>`
								)
							}
						})
					})
					if (!person.relation.length)
						$('#person__relations').html('<p>Not given</p>')

					// Carreer
					$('#person__career').html('')
					person.career.forEach(function (single_career) {
						$('#person__career').append(
							`<li>
								<p>${single_career.role} 
									${single_career.grade? '('+single_career.grade+')':''} in 
									${single_career.place} 
									[${single_career.category}].</p>
							</li>`
						)
					})
					if (!person.career || !person.career.length)
						$('#person__career').html('<p>Not given</p>')

					// Actions

					/*
						"actions": [{
							"role": "receiver",
							"name": "dedication_qoviusfreg"
						}],
					*/

					$('#person__actions').html('')
					person.actions.forEach(function (action) {
						var actionUrl = '../api/actions/' + action.name
						$.ajax({
							method: "GET",
							dataType: 'json',
							url: actionUrl,
							success: function (retrievedAction) {
								retrievedAction = retrievedAction[0]
								$('#person__actions').append(
									`<li><p>${action.role} of <a href="../action/${action.name}">${retrievedAction.title}</a></p></li>`)
							}
						})
					})
					if (!person.actions || !person.actions.length)
						$('#person__actions').html('<p>Not given</p>')

					// Documents
					$('#person__documents').html('')
					person.documents.forEach(function (doc) {
						$('#person__documents').append("<li><p><a href=\"../epigraph/" + doc + "\">" + doc + "</a></p></li>")
					})
				}
			})
		});
	</script>

</body>

</html>